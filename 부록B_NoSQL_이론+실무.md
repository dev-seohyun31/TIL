# 부록 B. NoSQL 이해하기 — 이론 & 실무 정리

---

# 🧭 ① 이론 중심 정리 — NoSQL 이해하기

## 1️⃣ 등장 배경

데이터 요구사항이 복잡해지고 다양해지면서 **RDBMS만으로는 대응하기 어려운** 시나리오가 늘어났다.  
예를 들어,
- 수천만 명 규모의 관계 분석 및 친구 추천  
- 실시간 로그 수집 후 통계 생성  
- TB~PB 단위 데이터 처리  

RDBMS는 샤딩으로 수평 확장이 가능하지만, **노드 간 의존성이 높아** 하나의 노드가 죽으면 데이터 손실 가능성이 있다.  
이러한 문제를 해결하기 위해 특정 요구사항에 맞춘 데이터 저장/조회 방식을 제공하는 **NoSQL(Not Only SQL)** 이 등장했다.

---

## 2️⃣ NoSQL이 다루는 주요 요구사항

| 요구사항 | 설명 | 대표 DB |
|-----------|-------|----------|
| 대용량 데이터 및 분산처리 | 수평 확장을 통해 용량 증가 및 장애 복원성 확보 | Cassandra, HBase |
| 고속 읽기/쓰기 | ACID 일부 희생 → 속도와 가용성 우선 | Cassandra, DynamoDB |
| 특정 모델에 최적화 | 키-값 또는 문서 기반 모델 제공 | DynamoDB, MongoDB |
| 비정형·유연한 스키마 | 신규 필드 추가 자유로움 | MongoDB, Couchbase |

---

## 3️⃣ NoSQL 종류와 특징

### ① 키-값(Key-Value) DB
- 구조: Map 형태 (`key → value`)
- 장점: 단순하고 읽기·쓰기 빠름
- 대표: **Redis**, DynamoDB  
- 용도: 세션 관리, 캐시, 설정 저장  
- Redis는 메모리 기반이므로 **AP 성향** (고가용 & 빠른 응답, 약한 일관성)

### ② 문서(Document) DB
- 구조: JSON 또는 BSON 형태의 문서
- 스키마 유연 → 데이터 모델과 도메인 모델이 직접 연결
- 대표: MongoDB
- 용도: 콘텐츠 관리, 제품 카탈로그, 유저 프로필 등

### ③ 컬럼 패밀리(Column-Family) DB
- 키-값 DB의 확장 버전, 하나의 키 아래 여러 컬럼 그룹 관리
- 대표: Cassandra, HBase
- 용도: 로그, IoT, 채팅 데이터 저장 등 대규모 데이터 관리

### ④ 그래프(Graph) DB
- 구조: 노드(Node) + 엣지(Edge)
- 관계를 명시적으로 저장하여 탐색 성능 우수
- 대표: Neo4j
- 용도: 소셜 그래프, 추천, 부정 탐지 (관계 기반 탐색)

---

## 4️⃣ 도입 시 고려사항

1. **트랜잭션 지원 여부**
   - 대부분의 NoSQL은 RDBMS 수준의 ACID 트랜잭션을 지원하지 않는다.  
   - 트랜잭션이 필요하다면 해당 DB의 ACID 지원 여부를 반드시 검증해야 한다.
   - RDBMS와 병행 사용 시 데이터 동기화 전략 필요.

2. **데이터 모델과 요구사항 일치 여부**
   - 예: 질문-답변 구조 → 문서형 DB / 단순 캐시 → 키-값 DB

3. **확장성과 일관성의 균형**
   - 대부분의 NoSQL은 **궁극적 일관성(Eventual Consistency)** 제공.  
     완전한 즉시 일관성을 요구하면 CP 계열 DB 선택 필요.

4. **운영 및 개발 역량**
   - 분산 클러스터 구조로 인해 백업, 확장, 모니터링이 복잡.  
     운영 자동화와 팀 역량 확보가 필요하다.

---

## 5️⃣ CAP 이론

> 분산 시스템에서 Consistency(일관성), Availability(가용성), Partition Tolerance(분할내성) 세 가지를 동시에 만족할 수는 없다.

| 특성 | 의미 |
|------|------|
| **C - 일관성** | 모든 노드가 동일한 데이터 상태 유지 |
| **A - 가용성** | 모든 요청이 항상 성공/실패 결과를 반환 |
| **P - 분할내성** | 네트워크 분리 상황에서도 시스템이 계속 동작 |

| 분류 | 제공 특성 | 예시 DB |
|------|-----------|---------|
| **CA** | 일관성 + 가용성 | RDBMS |
| **AP** | 가용성 + 분할내성 | Cassandra, DynamoDB, **Redis** |
| **CP** | 일관성 + 분할내성 | MongoDB, HBase |

📌 Redis는 AP에 가깝지만, RDB/AOF 옵션으로 데이터 영속성을 추가하면 일부 CP 성질을 띤다.

---

# ⚙️ ② 실무 중심 정리 — 개발자 관점의 NoSQL 활용

## 🧩 1. 언제 NoSQL을 고려해야 하나

| 상황 | 적합한 DB |
|------|------------|
| 대용량 로그, IoT 데이터 | Cassandra, HBase |
| 사용자 프로필, 상품 카탈로그 | MongoDB |
| 세션 관리, 인증 토큰, 캐시 | Redis, DynamoDB |
| 관계 탐색, 추천 알고리즘 | Neo4j |

---

## ⚡ 2. RDBMS → NoSQL 마이그레이션 체크리스트

1. **ACID 중 어떤 요소를 포기할 수 있는가?**  
   - 강한 정합성이 필요하면 MongoDB, CockroachDB, TiDB 등 선택.
2. **데이터 모델 변경 비용 고려**  
   - NoSQL은 JOIN이 어렵기 때문에 **데이터 중첩 저장(denormalization)** 이 필요.
3. **운영 인프라 준비**  
   - 모니터링 자동화 (Prometheus + Grafana 등) 필수.  
   - 장애 복구 및 복제(Replication) 테스트 필수.

---

## 🔧 3. 성능 및 운영 팁

- **Redis**
  - 인메모리 기반, 응답 속도 수백 μs 단위.  
  - `maxmemory-policy`, TTL, pub/sub 등 캐시 전략 활용.  
  - AOF 활성화 시 영속성 확보 가능.

- **MongoDB**
  - Replica Set 기반 CP DB.  
  - 샤딩 키 설계가 성능의 핵심.  
  - Index 범위 스캔 최소화 필요.

- **Cassandra**
  - 파티션 키 설계 중요 (잘못하면 핫스팟).  
  - Consistency Level(`ONE`, `QUORUM`, `ALL`) 로 읽기/쓰기 일관성 조절.

- **Kafka + CDC**
  - NoSQL 변경 이벤트를 Kafka로 전송하여 다른 시스템과 비동기 동기화.

---

## 🪶 4. 현업 운용 패턴

| 조합 | 목적 |
|------|------|
| RDBMS + Redis | 조회 성능 향상 및 부하 분산 |
| MongoDB + ElasticSearch | 검색 기능 강화 |
| Cassandra + Kafka | 실시간 로그/트래픽 분석 |
| Neo4j + ML | 사용자 관계 기반 추천 시스템 |

---

## ✅ 결론

- NoSQL은 RDBMS의 **대체가 아니라 보완재**이다.  
- **일관성(C)** 과 **가용성(A)** 중 어느 쪽을 우선시할지에 따라 DB를 선택해야 한다.  
- 도입 전에는 **운영 역량, 확장성, ACID 지원 범위**를 반드시 검증해야 한다.
