# 실제 개념
## ADC란? 
ADC(Analog to Digital Converter)란 연속적인 아날로그 전압을 디지털 정수 코드로 변환하여 CPU가 처리할 수 있도록 해주는 MCU 내부 하드웨어 주변장치입니다. 

CPU는 전압이나 연속적인 물리량을 직접 이해하지 못하고, 오직 비트와 정수 데이터만 처리할 수 있습니다.
따라서 온도 센서, 마이크, 조도 센서, 가변 저항같이 연속적으로 변화하는 전압 신호는 ADC를 통해 디지털 값으로 변환된 후 CPU로 전달됩니다.

이는 GPIO Input이 `핀 전압 -> IDR 비트(0/1)`로 상태를 전달하는 것과 유사하지만, ADC는 1비트 판별이 아니라 다비트 해상도로 전압 크기를 수치화합니다.

### ADC 수치 변환 예시
센서 출력이 0.73V, 기준 전압이 3.3V, 해상도가 12bit ADC(0~4095)일 때:
```
ADC Code = (V_in / V_ref) * (2^N - 1)
         = (0.73 / 3.3) * 4095
         = 3021
```
ADC는 절대 전압을 직접 저장하지 않고, 기준 전압 대비 비율을 디지털 코드로 변환합니다. 

#### 기준 전압 (V_ref)
ADC는 절대적인 전압을 측정하지 않고, 기준 전압(`V_ref`)에 대한 비율을 측정합니다.
따라서, `V_ref`가 흔들리거나 노이즈가 많으면 ADC 결과도 동일하게 불안정하므로, 정밀한 측정이 필요할 때에는 외부 정밀 기준 전압을 사용할 때도 있습니다.
#### 해상도
ADC 해상도는 전압을 몇단계로 나누어서 표현하는지 의미합니다.
* 10bit 해상도 = 1024 단계
* 12bit 해상도 = 4096 단계

예를 들어, 12bit ADC, V_ref = 3.3V인 경우 `3.3V / 4096 ≈ 0.8mV`가 되어, 0.8mV 단위로 전압을 구분할 수 있습니다. 




### 물리적 구조
```
외부 핀
 → Analog MUX (입력 선택)
 → Sample & Hold (전압 샘플 고정)
 → Comparator + 내부 DAC (SAR 변환)
 → Digital Result Register
```
#### 1. Analog Input Pin
GPIO 핀 중 일부는 ADC 입력 기능을 함께 제공합니다.
데이터시트에서는 다음과 같이 표현됩니다. : `PORT0.3 -> ADC Channel 3`
* `PORT0.3`: Port 0의 3번 핀을 의미하며, 외부 센서 전압이 실제로 연결됩니다.
* ADC Channel 3: ADC 모듈 내부에서 해당 핀을 식별하는 채널 번호입니다.

핀과 채널은 내부 MUX를 통해 연결되어 있고, 소프트웨어는 채널 번호를 선택해서 어떤 핀의 전압을 변환할지 지정합니다.
#### 2. Analog MUX
ADC는 보통 1개의 컨버터와 여러개의 입력 채널(핀)을 공유하는 구조를 가집니다.
* 변환기 1개
* 채널 여러개: ADC가 선택할 수 있는 입력 후보 라인으로, 대부분 외부 핀과 1:1 관계입니다.

MUX는 여러 입력 중 현재 변환기에 연결할 하나의 채널을 선택합니다.

#### 3. Sample & Hold
아날로그 전압은 시간에 따라 계속 변화하기 때문에, 해당 회로는 변환 과정 동안 입력 전압이 바뀌지 않도록 특정 순간의 전압을 커패시터에 저장합니다.
* **Sampling time**: 입력 전압을 커패시터에 충전하는 시간입니다.
    * 이 시간이 충분하지 않으면 전압이 충분히 충전되지 않아서 측정 오차가 발생할 수 있습니다.

#### 4. Comparator와 내부 DAC
대부분의 MCU ADC는 SAR(Successive Approximation Register) 방식을 사용합니다.
SAR 방식은 반복으로 값 비교를 통해 가장 근접한 디지털 코드를 찾아가는데, 구체적으로 다음과 같은 원리로 동작합니다.
1. 내부 DAC를 이용해 "시험용 전압"을 생성
1. Comparator로 입력 전압과 시험용 전압을 비교
1. MSB(최상위 비트)부터 하나씩 결정
1. 이진 탐색 방식으로 점점 오차 범위를 줄여가며 최종 값을 확정

* **Conversion Time**: SAR 비교 연산이 수행되는 시간입니다.
    * 이 시간이 너무 짧으면 정확도가 감소할 수 있습니다.


#### 5. Result Register
변환이 완료되면 ADC 하드웨어는 결과 값을 결과 레지스터에 저장합니다: `ADC_RESULT = 3021`

이 레지스터는 CPU가 직접 읽거나, DMA가 자동으로 메모리로 전송하는 출발지점 역할을 합니다.

## DAC란
DAC(Digital to Analog Converter)란 CPU가 생성한 디지털 정수 값을 연속적인 아날로그 전압 신호로 변환하는 주변장치입니다.
모터 속도 제어, 오디오 출력, 기준 전압 생성, 외부 아날로그 회로 제어와 같이 MCU가 직접 전압을 생성해야할 때, DAC가 이 역할을 담당합니다.

### DAC 출력 예시
12bit DAC, 기준 전압 3.3V, 출력 코드 2047일 때,
```
V_out = (Digital Code / (2^N - 1)) × V_ref
      = (2047 / 4095) × 3.3
      ≈ 1.65V
```
### 물리적 구조
DAC 역시 MCU 내부에 구현ㄴ된 실제 하드웨어 아날로그 블록입니다.
일반적인 출력 경로는 다음과 같습니다.
```
DAC Data Register
 → Switch Network
 → R-2R Resistor Ladder
 → Output Buffer
 → DAC Output Pin
```
#### (아래는 추후 공부)
#### 1. Switch Network
입력된 디지털 코드 비트 값에 따라 내부 스위치가 ON/OFF 되며,
저항 네트워크에 전류 경로를 구성합니다.

#### 2. Register Ladder
R-2R 레더 구조는 이중 가중치를 가진 저항 네트워크로, 각 비트가 출력 전압에 기여하는 비율을 결정합니다.
* MSB: 출력에 가장 큰 영향
* LSB: 미세 조정 역할

디지털 값이 전압 형태로 합성됩니다.

#### 3. Output Buffer
DAC 내부 출력 버퍼는 외부 회로와의 임피던스 차이를 완화하고 안정적인 전압 출력을 제공합니다.
부하가 큰 회로를 직접 구동하는 것은 권장되지 않으며, 필요 시 외부 OP-Amp를 사용합니다.
### 특징
1. DAC 출력은 연속적으로 보이지만, 실제로는 계단 형태입니다.
2. 출력 업데이트는 보통 Timer 트리거 기반으로 일정 주기를 유지합니다.
3. 오디오, 파형 출력에서는 DMA와 함께 사용되어 CPU 부하를 줄입니다.
