# 실제 개념
## ADC란? 
ADC(Analog to Digital Converter)란 연속적인 아날로그 전압을 CPU가 처리할 수 있는 정수 값으로 변환하는 주변장치입니다. 

CPU는 전압이나 연속적인 물리량을 직접 이해하지 못하고, 오직 비트와 숫자만 처리할 수 있습니다.
따라서 온도 센서, 마이크, 조도 센서, 가변 저항같은 입력은 연속적으로 변화하는 전압 신호 형태로 전달되므로, ADC가 중간 번역기 역할을 담당합니다.
> 즉, ADC는 센서 전압 -> 디지털 숫자 -> CPU 연산 흐름을 가능하게 하는 핵심 인터페이스입니다.

예를 들어 센서 출력이 0.73V일 때, 기준 전압이 3.3V이고 해상도가 12bit ADC(0~4095)라면 ADC는 다음과 같이 정수 코드로 변환합니다.
```
ADC Code = (V_in / V_ref) * (2^N - 1)
         = (0.73 / 3.3) * 4095
         = 3021
```
#### 기준 전압
ADC는 절대적인 전압을 측정하지 않고, 기준 전압(`V_ref`)에 대한 비율을 측정합니다.
따라서, `V_ref`가 흔들리거나 노이즈가 많으면 ADC 결과도 동일하게 불안정하므로, 정밀한 측정이 필요할 때에는 외부 정밀 기준 전압을 사용할 때도 있습니다.
#### 해상도
ADC 해상도는 전압을 몇단계로 나누어서 표현하는지 의미합니다.
* 10bit 해상도 = 1024 단계
* 12bit 해상도 = 4096 단계

예를 들어, 12bit ADC, V_ref = 3.3V인 경우 `3.3V / 4096 ≈ 0.8mV`가 되어, 0.8mV 단위로 전압을 구분할 수 있습니다. 




### 물리적 구조
ADC는 소프트웨어 개념이 아니라 MCU 내부에 구현된 실제 하드웨어 블록입니다.
```
외부 핀
 → Analog MUX (입력 선택)
 → Sample & Hold (전압 샘플 고정)
 → Comparator + 내부 DAC (SAR 변환)
 → Digital Result Register
```
#### 1. Analog Input Pin
GPIO 핀 중 일부는 ADC 입력 기능을 함께 제공합니다.
데이터시트에서는 다음과 같이 표현됩니다. : `PORT0.3 -> ADC Channel 3`
* `PORT0.3`: Port 0의 3번 물리 핀을 의미하며, 외부 센서 전압이 실제로 연결됩니다.
* ADC Channel 3: ADC 모듈 내부에서 해당 핀을 식별하는 채널 번호입니다.

핀과 채널은 내부 MUX를 통해 연결되어 있고, 소프트웨어는 채널 번호를 선택해서 어떤 핀의 전압을 변환할지 지정합니다.
#### 2. MUX
ADC는 보통 1개의 컨버터와 여러개의 입력 채널을 공유하는 구조를 가집니다.
* 변환기: 실제로 아날로그 전압을 디지털 값으로 변환한는 핵심 회로 블록입니다.
* 채널: ADC가 서택할 수 있ㄴ는 입력 후보 라인으로, 대부분 외부 핀과 1:1 관계입니다.

따라서 MUX는 여러 입력 채널 중 현재 변환기에 연ㄴ결할 하나의 입력을 선택합니다.

#### 3. Sample & Hold
아날로그 전압은 시간에 따라 미세하게 계속 변화하므로, 변환 과정 중에 입력 값이 변하지 않도록 특정 지점의 전압을 순간적으로 고정합니다.
Sample & Hold 회로는 커패시터를 이용해서 변환이 끝날 때까지 그 값을 유지합니다.
* **Sampling time**: 입력 전압을 커패시터에 충전하는 시간입니다. 이 시간이 충분하지 않으면 전압이 충분히 충전되지 않아서 측정 오차가 발생할 수 있습니다.

#### 4. Comparator와 내부 DAC
대부분의 MCU ADC는 SAR(Successive Approximation Register) 방식을 사용합니다.
SAR 방식은 반복으로 값 비교를 통해 가장 근접한 디지털 코드를 찾아가는데, 구체적으로 다음과 같은 원리로 동작합니다.
1. 내부 DAC를 이용해 “시험용 전압”을 생성
1. 입력 전압과 비교기(Comparator)로 크기 비교
1. MSB(최상위 비트)부터 하나씩 결정
1. 이진 탐색 방식으로 점점 오차 범위를 줄여가며 최종 디지털 값을 확정

* **Conversion Time**: SAR 비교 연산이 수행되는 시간입니다. 이 시간이 너무 짧으면 정확도가 감소할 수 있습니다.


#### 5. Result Register
변환이 완료되면 ADC 하드웨어는 결과 값을 결과 레지스터에 저장합니다: `ADC_RESULT = 3021`

CPU는 이 레지스터를 읽어서 센서 값을 계산하거나, 제어 알고리즘을 수행하거나, 통신 데이터 전송 등의 처리를 수행할 수 있습니다.

## DAC란
DAC(Digital to Analog Converter)란 CPU가 생성한 디지털 정수 값을 연속적인 아날로그 전압 신호로 변환하는 주변장치입니다.
모터 속도 제어, 오디오 출력, 기준 전압 생성, 외부 아날로그 회로 제어와 같이 MCU가 직접 전압을 생성해야할 때, DAC가 이 역할을 담당합니다.

예를 들어 DAC 출력 값이 2047이고 기준 전압(`V_ref`)이 3.3V이며 해상도가 12bit라면 출력 전압은 다음과 같이 계산될 수 있습니다.
```
V_out = (Digital Code / (2^N - 1)) × V_ref
      = (2047 / 4095) × 3.3
      ≈ 1.65V
```
### 물리적 구조
DAC 역시 MCU 내부에 구현ㄴ된 실제 하드웨어 아날로그 블록입니다.
일반적인 출력 경로는 다음과 같습니다.
```
Digital Data Register
 → Switch Network
 → Resistor Ladder (R-2R Network)
 → Output Buffer
 → DAC Output Pin
```
### (아래 원리 다시 확인해야 함)
#### 1. Switch Network
입력된 디지털 코드의 비트 값에 따라, 내부 스위치들이 켜지고 꺼면서 저항 네트워크에 전류 경로를 구성합니다.


#### 2. Register Ladder
R-2R 레더 구조는 이중 가중치를 가진 저항 네트워크로, 각 비트가 출력 전압에 기여하는 비율을 결정합니다.
* MSB: 출력에 가장 큰 영향
* LSB: 미세 조정 역할

#### 3. Output Buffer
DAC 내부 출력 버퍼는 외부 회로와의 임피던스 차이를 완화하고 안정적인 전압 출력을 제공합니다.
부하가 큰 회로를 직접 구동하는 것은 권장되지 않으며, 필요 시 외부 OP-Amp를 사용합니다.
### 특징
1. DAC 출력은 연속적으로 보이지만, 실제로는 계단 형태입니다.
