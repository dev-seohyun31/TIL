# 실제 개념
## 메모리 맵이란
메모리 맵이란, CPU가 쓰는 주소 공간에 어떤 하드웨어 자원이 어떤 주소 범위를 차지하는지 정의된 "하드웨어 주소 배치" 명세입니다. 
메모리 맵은 MCU 내부 버스 구조와 주소 디코더 회로에 의해 하드웨어로 고정된 구조입니다. 아래와 같은 명세들이 칩 설계 단계에서 이미 물리적으로 구현되어 있습니다. 
```
0x0000_0000  ── Boot ROM
0x0800_0000  ── Flash (Program)
0x2000_0000  ── RAM
0x4000_0000  ── Peripheral Register
0xE000_0000  ── System Control Space
```

## CPU 관점에서 Memory Map의 의미
CPU는 다음 세가지 메모리 동작만 할 수 있습니다. 
* FETCH (명령어 가져오기)
* LOAD (메모리 읽기)
* STORE (메모리 쓰기)

CPU는 이 주소가 Flash인지, RAM인지, UART인지 알지 못합니다.
대신, 주소를 내보내면 내부 버스 인터컨넥트와 주소 디코더가 해당 주소를 담당하는 하드웨어 블록으로 연결해줍니다.
* Flash 주소 → Flash 컨트롤러
* RAM 주소 → SRAM
* GPIO 주소 → GPIO 레지스터 블록

이로써 CPU는 주소만 알아도 MCU 내부의 모든 장치를 제어할 수 있고, 주변 장치를 메모리처럼 다뤄서 하드웨어를 제어할 수 있습니다. (Memory-Mapped Architecture)
## Memory-Mapped I/O의 의미
주변장치를 “메모리처럼” 다룰 수 있는 이유는 GPIO, UART, Timer 레지스터가 주소 공간에 포함되어 있기 때문입니다. 
```C
*(volatile uint32_t*)GPIO_BASE = 0x1;
```
```C
#define GPIO_OUT (*(volatile uint32_t*)0xF003A100)
```
이 코드는 RAM에 쓰는게 아니라, GPIO 하드웨어 레지스터에 전기 신호를 쓰는 것입니다. 

## 일반적인 MCU Memory Map 구조
```
(낮은 주소)
- Boot ROM
- Flash (program)
- RAM (Data/Stack/Heap)
- Peripherals (MMIO 레지스터: GPIO, UART, Timer, ..)
- System Control (Interrupt, Clock, Watchdog, ..)
(높은 주소)
```

1. Boot ROM 영역
    * Reset 직후 PC가 자동으로 진입하는 주소
    * 하는 일: 부트 모드 판단, Flash 유효성 검사, Secure Boot 시작, Flash Reset Vector로 점프 수행
    * 항상 슈퍼바이저 모드로 실행되며, 시스템 신뢰의 시작점입니다. 
2. Flash (program) 영역
    * `.text`: 기계어 코드
    * `.rodata`: 읽기 전용 데이터 (`const` 상수)
    * 시스템 구조: Interrupt Vector Table, Reset Vector, Startup code)
3. RAM 영역
    * `.data`: 초기값 있는 전역/정적 변수
    * `.bss`: 초기값 없는 전역/정적 변수
    * `stack`: 함수 호출, 지역 변수, ISR 컨텍스트
    * `heap`: `malloc`, `new`
4. Peripheral MMIO 영역
    * 메모리가 아니라, 하드웨어 레지스터 집합입니다.
    * GPIO
    * UART
    * SPI/I2C
    * Timer
    * ADC
    * DMA
5. System Control 영역
    *CPU 및 SoC 제어 핵심 레지스터입니다.
    * Interrupt Controller
    * Watchdog
    * Clock/Reset 컨트롤
    * MPU/MMU 설정 레지스터 
